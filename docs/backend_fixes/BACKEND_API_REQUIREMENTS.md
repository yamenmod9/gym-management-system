# üöÄ Backend API Requirements for Gym Management System

## üìã Overview
This document contains all the API endpoints required for the Flutter gym management frontend to function properly. The base URL is: `https://yamenmod91.pythonanywhere.com`

---

## üîê Authentication Endpoints

### 1. Login
**Endpoint:** `POST /api/auth/login`

**Request:**
```json
{
  "username": "reception1",
  "password": "reception123"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "reception1",
      "full_name": "Reception Staff",
      "email": "reception@gym.com",
      "phone": "0201234567",
      "role": "reception",
      "branch_id": 1,
      "branch_name": "Dragon Club",
      "is_active": true
    }
  }
}
```

**Error Response (401):**
```json
{
  "success": false,
  "message": "Invalid username or password"
}
```

---

### 2. Logout
**Endpoint:** `POST /api/auth/logout`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

---

### 3. Get Profile
**Endpoint:** `GET /api/auth/profile`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "reception1",
    "full_name": "Reception Staff",
    "email": "reception@gym.com",
    "phone": "0201234567",
    "role": "reception",
    "branch_id": 1,
    "branch_name": "Dragon Club",
    "is_active": true
  }
}
```

---

## üë• Customer Management Endpoints

### 4. Register Customer
**Endpoint:** `POST /api/customers/register`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "full_name": "John Doe",
  "phone": "+1234567890",
  "email": "john@example.com",
  "gender": "male",
  "age": 25,
  "weight": 75.0,
  "height": 1.75,
  "bmi": 24.5,
  "bmi_category": "Normal",
  "bmr": 1750.0,
  "daily_calories": 2450.0,
  "branch_id": 1
}
```

**Success Response (201):**
```json
{
  "success": true,
  "message": "Customer registered successfully",
  "data": {
    "id": 123,
    "full_name": "John Doe",
    "phone": "+1234567890",
    "email": "john@example.com",
    "gender": "male",
    "age": 25,
    "weight": 75.0,
    "height": 1.75,
    "bmi": 24.5,
    "bmi_category": "Normal",
    "bmr": 1750.0,
    "daily_calories": 2450.0,
    "qr_code": "GYM_CUSTOMER_123",
    "branch_id": 1,
    "created_at": "2026-02-10T10:30:00Z"
  }
}
```

**Notes:**
- `qr_code` should be auto-generated by backend (e.g., "GYM_CUSTOMER_{id}")
- Phone and email are optional
- All numeric health metrics are required
- Backend should generate unique customer ID

---

### 5. Get Customers List
**Endpoint:** `GET /api/customers`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional): Filter by branch
- `limit` (optional): Number of records (default: 50)
- `offset` (optional): For pagination

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 123,
      "full_name": "John Doe",
      "phone": "+1234567890",
      "email": "john@example.com",
      "gender": "male",
      "age": 25,
      "qr_code": "GYM_CUSTOMER_123",
      "branch_id": 1,
      "has_active_subscription": true,
      "subscription_status": "active",
      "created_at": "2026-02-10T10:30:00Z"
    }
  ],
  "total": 150
}
```

---

### 6. Get Customer by ID
**Endpoint:** `GET /api/customers/{id}`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "id": 123,
    "full_name": "John Doe",
    "phone": "+1234567890",
    "email": "john@example.com",
    "gender": "male",
    "age": 25,
    "weight": 75.0,
    "height": 1.75,
    "bmi": 24.5,
    "bmi_category": "Normal",
    "bmr": 1750.0,
    "daily_calories": 2450.0,
    "qr_code": "GYM_CUSTOMER_123",
    "branch_id": 1,
    "created_at": "2026-02-10T10:30:00Z"
  }
}
```

---

## üí≥ Subscription Management Endpoints

### 7. Activate Subscription ‚ö†Ô∏è CRITICAL - Currently Failing
**Endpoint:** `POST /api/subscriptions/activate`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "customer_id": 123,
  "service_id": 1,
  "branch_id": 1,
  "amount": 100.00,
  "payment_method": "cash"
}
```

**Success Response (201):**
```json
{
  "success": true,
  "message": "Subscription activated successfully",
  "data": {
    "subscription_id": 456,
    "customer_id": 123,
    "service_id": 1,
    "start_date": "2026-02-10",
    "end_date": "2026-03-10",
    "status": "active",
    "amount": 100.00,
    "payment_method": "cash",
    "created_at": "2026-02-10T10:30:00Z"
  }
}
```

**Error Response (400):**
```json
{
  "success": false,
  "message": "Customer already has an active subscription"
}
```

**Notes:**
- This endpoint is currently returning errors in the app
- Check for existing active subscriptions before creating
- Calculate `end_date` based on service duration
- Payment methods: "cash", "card", "transfer"

---

### 8. Renew Subscription
**Endpoint:** `POST /api/subscriptions/renew`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "subscription_id": 456,
  "amount": 100.00,
  "payment_method": "cash"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Subscription renewed successfully",
  "data": {
    "subscription_id": 456,
    "new_end_date": "2026-04-10",
    "status": "active",
    "amount": 100.00
  }
}
```

---

### 9. Freeze Subscription
**Endpoint:** `POST /api/subscriptions/freeze`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "subscription_id": 456,
  "freeze_days": 7
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Subscription frozen successfully",
  "data": {
    "subscription_id": 456,
    "status": "frozen",
    "frozen_until": "2026-02-17",
    "new_end_date": "2026-03-17"
  }
}
```

---

### 10. Stop Subscription
**Endpoint:** `POST /api/subscriptions/stop`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "subscription_id": 456
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Subscription stopped successfully",
  "data": {
    "subscription_id": 456,
    "status": "stopped",
    "stopped_at": "2026-02-10T10:30:00Z"
  }
}
```

---

### 11. Get Subscriptions
**Endpoint:** `GET /api/subscriptions`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `customer_id` (optional): Filter by customer
- `branch_id` (optional): Filter by branch
- `status` (optional): active, expired, frozen, stopped

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 456,
      "customer_id": 123,
      "customer_name": "John Doe",
      "service_id": 1,
      "service_name": "Monthly Membership",
      "start_date": "2026-02-10",
      "end_date": "2026-03-10",
      "status": "active",
      "amount": 100.00,
      "branch_id": 1
    }
  ],
  "total": 50
}
```

---

## üí∞ Payment Endpoints

### 12. Record Payment
**Endpoint:** `POST /api/payments/record`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "customer_id": 123,
  "amount": 100.00,
  "payment_method": "cash",
  "branch_id": 1,
  "subscription_id": 456,
  "notes": "Monthly payment",
  "payment_date": "2026-02-10T10:30:00Z"
}
```

**Success Response (201):**
```json
{
  "success": true,
  "message": "Payment recorded successfully",
  "data": {
    "payment_id": 789,
    "customer_id": 123,
    "amount": 100.00,
    "payment_method": "cash",
    "receipt_number": "REC-2026-0210-001",
    "created_at": "2026-02-10T10:30:00Z"
  }
}
```

---

### 13. Daily Closing
**Endpoint:** `POST /api/payments/daily-closing`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "branch_id": 1,
  "closing_date": "2026-02-10"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Daily closing completed successfully",
  "data": {
    "closing_id": 101,
    "branch_id": 1,
    "closing_date": "2026-02-10",
    "total_cash": 5000.00,
    "total_card": 3000.00,
    "total_transfer": 2000.00,
    "total_amount": 10000.00,
    "transaction_count": 45,
    "closed_by": "reception1",
    "closed_at": "2026-02-10T23:00:00Z"
  }
}
```

---

### 14. Get Payments
**Endpoint:** `GET /api/payments`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `start_date` (optional): YYYY-MM-DD
- `end_date` (optional): YYYY-MM-DD
- `payment_method` (optional)

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 789,
      "customer_id": 123,
      "customer_name": "John Doe",
      "amount": 100.00,
      "payment_method": "cash",
      "receipt_number": "REC-2026-0210-001",
      "branch_id": 1,
      "created_at": "2026-02-10T10:30:00Z"
    }
  ],
  "total": 472
}
```

---

## üè¢ Branch Endpoints

### 15. Get Branches
**Endpoint:** `GET /api/branches`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Dragon Club",
      "location": "Downtown",
      "phone": "0201234567",
      "is_active": true
    },
    {
      "id": 2,
      "name": "Phoenix Club",
      "location": "Uptown",
      "phone": "0201234568",
      "is_active": true
    }
  ]
}
```

---

### 16. Get Branch Performance
**Endpoint:** `GET /api/branches/{id}/performance`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "branch_id": 1,
    "branch_name": "Dragon Club",
    "total_customers": 60,
    "active_subscriptions": 35,
    "monthly_revenue": 65000.00,
    "open_complaints": 1,
    "staff_count": 3,
    "performance_score": 92.5
  }
}
```

---

## üèãÔ∏è Service Endpoints

### 17. Get Services
**Endpoint:** `GET /api/services`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Monthly Membership",
      "description": "Full access to gym facilities",
      "price": 500.00,
      "duration_days": 30,
      "is_active": true
    },
    {
      "id": 2,
      "name": "3-Month Membership",
      "description": "Quarterly gym membership",
      "price": 1350.00,
      "duration_days": 90,
      "is_active": true
    }
  ]
}
```

---

## üìù Complaint Endpoints

### 18. Submit Complaint
**Endpoint:** `POST /api/complaints/submit`

**Headers:** `Authorization: Bearer {token}`

**Request:**
```json
{
  "title": "Equipment not working",
  "description": "Treadmill 3 is broken",
  "branch_id": 1,
  "customer_id": 123
}
```

**Success Response (201):**
```json
{
  "success": true,
  "message": "Complaint submitted successfully",
  "data": {
    "complaint_id": 555,
    "title": "Equipment not working",
    "status": "pending",
    "created_at": "2026-02-10T10:30:00Z"
  }
}
```

---

### 19. Get Complaints
**Endpoint:** `GET /api/complaints`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `status` (optional): pending, resolved
- `start_date` (optional)
- `end_date` (optional)

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 555,
      "title": "Equipment not working",
      "description": "Treadmill 3 is broken",
      "status": "pending",
      "branch_id": 1,
      "branch_name": "Dragon Club",
      "customer_id": 123,
      "customer_name": "John Doe",
      "created_at": "2026-02-10T10:30:00Z",
      "resolved_at": null
    }
  ],
  "total": 11
}
```

---

## üìä Reports Endpoints (For Owner & Accountants)

### 20. Revenue Report
**Endpoint:** `GET /api/reports/revenue`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD
- `group_by` (optional): service, branch, payment_method

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "total_revenue": 164521.00,
    "total_transactions": 472,
    "breakdown": [
      {
        "category": "Monthly Membership",
        "amount": 120000.00,
        "count": 350
      },
      {
        "category": "Personal Training",
        "amount": 30000.00,
        "count": 80
      }
    ]
  }
}
```

---

### 21. Daily Report
**Endpoint:** `GET /api/reports/daily`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (required for managers)
- `date` (optional): YYYY-MM-DD (default: today)

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "date": "2026-02-10",
    "branch_id": 1,
    "total_revenue": 5000.00,
    "new_customers": 5,
    "new_subscriptions": 8,
    "renewals": 3,
    "check_ins": 45
  }
}
```

---

### 22. Weekly Report
**Endpoint:** `GET /api/reports/weekly`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "week_start": "2026-02-03",
    "week_end": "2026-02-09",
    "total_revenue": 35000.00,
    "new_customers": 25,
    "active_subscriptions": 83
  }
}
```

---

### 23. Monthly Report
**Endpoint:** `GET /api/reports/monthly`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `month` (optional): YYYY-MM

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "month": "2026-02",
    "total_revenue": 164521.00,
    "new_customers": 150,
    "active_subscriptions": 83,
    "churn_rate": 5.2
  }
}
```

---

### 24. Branch Comparison
**Endpoint:** `GET /api/reports/branch-comparison`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "branch_id": 1,
      "branch_name": "Dragon Club",
      "revenue": 70000.00,
      "customers": 60,
      "active_subscriptions": 35,
      "open_complaints": 1,
      "rank": 1
    },
    {
      "branch_id": 2,
      "branch_name": "Phoenix Club",
      "revenue": 55000.00,
      "customers": 55,
      "active_subscriptions": 30,
      "open_complaints": 0,
      "rank": 2
    },
    {
      "branch_id": 3,
      "branch_name": "Tiger Club",
      "revenue": 40000.00,
      "customers": 35,
      "active_subscriptions": 18,
      "open_complaints": 10,
      "rank": 3
    }
  ]
}
```

---

### 25. Employee Performance
**Endpoint:** `GET /api/reports/employee-performance`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "employee_id": 5,
      "employee_name": "reception_dragon_1",
      "role": "reception",
      "branch_id": 1,
      "transactions_processed": 150,
      "revenue_generated": 35000.00,
      "customers_registered": 20
    }
  ]
}
```

---

## üíµ Finance Endpoints (For Accountants)

### 26. Daily Sales
**Endpoint:** `GET /api/finance/daily-sales`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `service_id` (optional)
- `payment_method` (optional)
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "total_sales": 164521.00,
    "total_transactions": 472,
    "cash_sales": 65808.40,
    "card_sales": 65808.40,
    "transfer_sales": 32904.20,
    "by_date": [
      {
        "date": "2026-02-10",
        "total": 5000.00,
        "transactions": 15
      }
    ]
  }
}
```

---

### 27. Expenses
**Endpoint:** `GET /api/finance/expenses`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD
- `status` (optional): pending, approved, rejected

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 201,
      "title": "Equipment Maintenance",
      "description": "Repair treadmill",
      "amount": 5000.00,
      "category": "Maintenance",
      "status": "pending",
      "branch_id": 1,
      "created_at": "2026-02-08T10:00:00Z",
      "days_pending": 2,
      "is_urgent": false
    },
    {
      "id": 202,
      "title": "Utility Bill",
      "description": "Electricity bill",
      "amount": 8000.00,
      "category": "Utilities",
      "status": "pending",
      "branch_id": 1,
      "created_at": "2026-02-01T10:00:00Z",
      "days_pending": 9,
      "is_urgent": true
    }
  ],
  "total": 10,
  "pending_amount": 77070.00,
  "urgent_count": 3
}
```

---

### 28. Cash Differences
**Endpoint:** `GET /api/finance/cash-differences`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `start_date` (required): YYYY-MM-DD
- `end_date` (required): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "closing_id": 101,
      "branch_id": 1,
      "branch_name": "Dragon Club",
      "date": "2026-02-10",
      "expected_cash": 5000.00,
      "actual_cash": 4950.00,
      "difference": -50.00,
      "status": "reviewed",
      "priority": "low"
    },
    {
      "closing_id": 102,
      "branch_id": 2,
      "branch_name": "Phoenix Club",
      "date": "2026-02-09",
      "expected_cash": 4500.00,
      "actual_cash": 4700.00,
      "difference": 200.00,
      "status": "pending",
      "priority": "high"
    }
  ],
  "total_differences": 5,
  "high_priority_count": 2
}
```

---

## üëî Attendance Endpoints (For Managers)

### 29. Get Attendance
**Endpoint:** `GET /api/attendance`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `date` (optional): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 301,
      "employee_id": 5,
      "employee_name": "reception_dragon_1",
      "branch_id": 1,
      "date": "2026-02-10",
      "check_in_time": "08:00:00",
      "check_out_time": "17:00:00",
      "status": "present",
      "hours_worked": 9.0
    }
  ]
}
```

---

### 30. Get Attendance by Branch
**Endpoint:** `GET /api/attendance/by-branch`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (required)
- `start_date` (optional): YYYY-MM-DD
- `end_date` (optional): YYYY-MM-DD

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "employee_id": 5,
      "employee_name": "reception_dragon_1",
      "total_days": 20,
      "present_days": 19,
      "absent_days": 1,
      "late_days": 2,
      "attendance_rate": 95.0
    }
  ]
}
```

---

## üö® Alert Endpoints (For Owner)

### 31. Get Smart Alerts
**Endpoint:** `GET /api/alerts/smart`

**Headers:** `Authorization: Bearer {token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "type": "expiring_subscriptions",
      "title": "Subscriptions Expiring Soon",
      "message": "13 subscriptions expiring soon",
      "description": "2 expire in 48 hours, 11 expire in 7 days",
      "priority": "high",
      "count": 13,
      "details": {
        "urgent_count": 2,
        "warning_count": 11
      },
      "created_at": "2026-02-10T10:00:00Z"
    },
    {
      "type": "open_complaints",
      "title": "Open Complaints",
      "message": "11 complaints require attention",
      "description": "Tiger Club has 10 open complaints",
      "priority": "high",
      "count": 11,
      "details": {
        "by_branch": [
          {"branch_id": 1, "branch_name": "Dragon Club", "count": 1},
          {"branch_id": 2, "branch_name": "Phoenix Club", "count": 0},
          {"branch_id": 3, "branch_name": "Tiger Club", "count": 10}
        ]
      },
      "created_at": "2026-02-10T10:00:00Z"
    },
    {
      "type": "pending_expenses",
      "title": "Pending Expenses",
      "message": "10 expenses awaiting approval",
      "description": "3 urgent expenses pending over 7 days",
      "priority": "medium",
      "count": 10,
      "details": {
        "total_amount": 77070.00,
        "urgent_count": 3
      },
      "created_at": "2026-02-10T10:00:00Z"
    },
    {
      "type": "cash_differences",
      "title": "Cash Reconciliation Issues",
      "message": "5 daily closings with discrepancies",
      "description": "High priority alerts for differences over 100 EGP",
      "priority": "high",
      "count": 5,
      "details": {
        "high_priority_count": 2,
        "total_difference": 350.00
      },
      "created_at": "2026-02-10T10:00:00Z"
    }
  ]
}
```

---

### 32. Get All Alerts
**Endpoint:** `GET /api/alerts`

**Headers:** `Authorization: Bearer {token}`

**Query Parameters:**
- `branch_id` (optional)
- `type` (optional)
- `priority` (optional): low, medium, high

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 401,
      "type": "subscription",
      "message": "Subscription for John Doe expires in 2 days",
      "priority": "high",
      "branch_id": 1,
      "is_read": false,
      "created_at": "2026-02-10T10:00:00Z"
    }
  ]
}
```

---

## üì± Client App Endpoints (For Customer Mobile App)

### 33. Request Activation Code
**Endpoint:** `POST /api/clients/request-activation`

**No Authentication Required**

**Request:**
```json
{
  "identifier": "01234567890"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Activation code sent successfully"
}
```

**Notes:**
- `identifier` can be phone number or email
- Generate a random 6-digit code
- Store code with 10-minute expiration
- In production, send SMS/email (can be mocked for testing)

---

### 34. Verify Activation Code
**Endpoint:** `POST /api/clients/verify-activation`

**No Authentication Required**

**Request:**
```json
{
  "identifier": "01234567890",
  "activation_code": "123456"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Activation successful",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "customer": {
      "id": 123,
      "full_name": "John Doe",
      "phone": "01234567890",
      "email": "john@example.com"
    }
  }
}
```

**Error Response (400):**
```json
{
  "success": false,
  "message": "Invalid or expired activation code"
}
```

---

### 35. Get Client Profile
**Endpoint:** `GET /api/clients/profile`

**Headers:** `Authorization: Bearer {client_token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "id": 123,
    "full_name": "John Doe",
    "phone": "01234567890",
    "email": "john@example.com",
    "gender": "male",
    "age": 25,
    "weight": 75.0,
    "height": 1.75,
    "bmi": 24.5,
    "qr_code": "GYM_CUSTOMER_123",
    "branch_id": 1,
    "branch_name": "Dragon Club"
  }
}
```

---

### 36. Get Client Subscription
**Endpoint:** `GET /api/clients/subscription`

**Headers:** `Authorization: Bearer {client_token}`

**Success Response (200):**
```json
{
  "success": true,
  "data": {
    "subscription_id": 456,
    "service_name": "Monthly Membership",
    "start_date": "2026-02-10",
    "end_date": "2026-03-10",
    "days_remaining": 28,
    "status": "active",
    "is_frozen": false
  }
}
```

**No Active Subscription (200):**
```json
{
  "success": true,
  "data": null,
  "message": "No active subscription"
}
```

---

### 37. Get Client Entry History
**Endpoint:** `GET /api/clients/entry-history`

**Headers:** `Authorization: Bearer {client_token}`

**Query Parameters:**
- `limit` (optional): default 50

**Success Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": 501,
      "check_in_time": "2026-02-10T08:00:00Z",
      "check_out_time": "2026-02-10T10:00:00Z",
      "duration_minutes": 120,
      "branch_name": "Dragon Club"
    }
  ],
  "total": 45
}
```

---

### 38. Refresh QR Code
**Endpoint:** `POST /api/clients/refresh-qr`

**Headers:** `Authorization: Bearer {client_token}`

**Success Response (200):**
```json
{
  "success": true,
  "message": "QR code refreshed successfully",
  "data": {
    "qr_code": "GYM_CUSTOMER_123_V2",
    "generated_at": "2026-02-10T10:30:00Z"
  }
}
```

---

## ‚ö†Ô∏è Error Responses

All endpoints should return appropriate HTTP status codes:

### 400 Bad Request
```json
{
  "success": false,
  "message": "Validation error",
  "errors": {
    "field_name": ["Error message"]
  }
}
```

### 401 Unauthorized
```json
{
  "success": false,
  "message": "Authentication required"
}
```

### 403 Forbidden
```json
{
  "success": false,
  "message": "You do not have permission to access this resource"
}
```

### 404 Not Found
```json
{
  "success": false,
  "message": "Resource not found"
}
```

### 422 Unprocessable Entity
```json
{
  "success": false,
  "message": "Invalid data provided",
  "errors": {
    "field_name": ["Specific error message"]
  }
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "message": "Internal server error",
  "error": "Error details (only in development)"
}
```

---

## üîë Authentication & Authorization

### JWT Token Format
- All authenticated endpoints require: `Authorization: Bearer {token}`
- Tokens should expire after 24 hours
- Refresh tokens should be valid for 7 days
- Include user role and branch_id in token claims

### Role-Based Access Control

| Role | Access |
|------|--------|
| **reception** | Customers, Subscriptions, Payments, Complaints (own branch only) |
| **manager** | All reception features + Branch reports, Staff attendance (own branch only) |
| **accountant** | Financial reports, Expenses, All branches (read-only) |
| **baccountant** | Same as accountant but for single branch only |
| **owner** | Full access to all endpoints across all branches |

---

## üìù Important Notes

### Critical Issues to Fix:

1. **Subscription Activation (Endpoint #7)** - Currently failing in production
   - This is the most critical endpoint to implement/fix
   - Frontend is getting errors when trying to activate subscriptions
   - Check for validation errors or missing endpoint

2. **Customer Registration (Endpoint #4)** - Works but QR code generation needed
   - Backend must auto-generate unique QR codes
   - Format: "GYM_CUSTOMER_{customer_id}"

3. **Data Filtering**
   - Reception and managers should only see their branch data
   - Implement proper branch_id filtering based on user role
   - Owner and accountants should see all branches

### Response Format Consistency
- All responses should include `success: boolean`
- Success responses should have `data` object
- Error responses should have `message` string
- Use consistent date format: ISO 8601 (YYYY-MM-DDTHH:mm:ssZ)

### Testing Priority
Test endpoints in this order:
1. Login ‚úÖ (Working)
2. Get Services (Needed for subscriptions)
3. Register Customer (Works but check QR generation)
4. **Activate Subscription** ‚ö†Ô∏è (CRITICAL - Currently failing)
5. Record Payment
6. Daily Closing
7. Reports endpoints

---

## üß™ Quick Test Commands

### 1. Test Login
```bash
curl -X POST https://yamenmod91.pythonanywhere.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"reception1","password":"reception123"}'
```

### 2. Test Register Customer (use token from login)
```bash
curl -X POST https://yamenmod91.pythonanywhere.com/api/customers/register \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "full_name": "Test Customer",
    "phone": "01234567890",
    "gender": "male",
    "age": 25,
    "weight": 75.0,
    "height": 1.75,
    "bmi": 24.5,
    "bmi_category": "Normal",
    "bmr": 1750.0,
    "daily_calories": 2450.0,
    "branch_id": 1
  }'
```

### 3. Test Activate Subscription ‚ö†Ô∏è (CRITICAL)
```bash
curl -X POST https://yamenmod91.pythonanywhere.com/api/subscriptions/activate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "customer_id": 123,
    "service_id": 1,
    "branch_id": 1,
    "amount": 100.00,
    "payment_method": "cash"
  }'
```

---

## üìû Support

If you need clarification on any endpoint or encounter issues during implementation:
1. Check the error response format
2. Verify authentication token is valid
3. Ensure request data matches the exact format shown
4. Test with curl commands before implementing in code

Base URL: `https://yamenmod91.pythonanywhere.com`

All endpoints are prefixed with `/api`

Good luck with the implementation! üöÄ

